<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #ffffff;
            color: #000000;
            padding: 20px;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            border-bottom: 1px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        header h1 {
            font-size: 14px;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        header p {
            font-size: 10px;
            margin-top: 5px;
            color: #666;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1px;
            background: #000;
            border: 1px solid #000;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #fff;
            padding: 15px;
        }
        
        .stat-card .label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #666;
        }
        
        .stat-card .value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .stat-card .subtext {
            font-size: 9px;
            color: #999;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
        }
        
        .chart-card {
            border: 1px solid #000;
            padding: 20px;
        }
        
        .chart-card h2 {
            font-size: 11px;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            border-bottom: 1px solid #000;
            padding-bottom: 8px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            font-size: 11px;
        }
        
        .error {
            border: 1px solid #000;
            padding: 20px;
            margin: 20px 0;
            background: #f0f0f0;
        }
        
        .error h3 {
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: normal;
        }
        
        .refresh-info {
            border: 1px solid #000;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            background: #fafafa;
        }
        
        .refresh-info .time {
            font-size: 9px;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Health Analytics</h1>
            <p>mi band 10 / apple health data</p>
        </header>
        
        <div id="loading" class="loading">
            <div>loading data...</div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="content" style="display: none;">
            <div class="refresh-info">
                <div><strong>last updated:</strong> <span id="lastUpdate"></span></div>
                <div class="time">synced from apple health export</div>
            </div>
            
            <div class="stats-grid" id="statsGrid"></div>
            
            <div id="advancedMetrics" style="margin-bottom: 30px;"></div>
            
            <div id="workoutAnalysis" style="margin-bottom: 30px;"></div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <h2>heart rate / last 30 days</h2>
                    <div class="chart-container">
                        <canvas id="heartRateChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h2>daily steps / last 30 days</h2>
                    <div class="chart-container">
                        <canvas id="stepsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h2>sleep duration / last 30 days</h2>
                    <div class="chart-container">
                        <canvas id="sleepChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h2>active energy / last 30 days</h2>
                    <div class="chart-container">
                        <canvas id="energyChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h2>distance walked/run / last 30 days</h2>
                    <div class="chart-container">
                        <canvas id="distanceChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h2>heart rate distribution / all time</h2>
                    <div class="chart-container">
                        <canvas id="hrDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let healthData = null;
        
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
            },
            scales: {
                y: {
                    grid: { color: '#e0e0e0' },
                    ticks: { 
                        font: { family: "'Courier New', monospace", size: 10 },
                        color: '#000'
                    }
                },
                x: {
                    grid: { color: '#e0e0e0' },
                    ticks: { 
                        font: { family: "'Courier New', monospace", size: 10 },
                        color: '#000'
                    }
                }
            }
        };
        
        async function loadHealthData() {
            try {
                const response = await fetch('health_data.json');
                if (!response.ok) {
                    throw new Error('health data not found');
                }
                healthData = await response.json();
                displayDashboard();
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `
                    <h3>error loading data</h3>
                    <p>${error.message}</p>
                    <p>run: python3 health_analyzer.py</p>
                `;
            }
        }
        
        function displayDashboard() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            
            const lastUpdate = new Date(healthData.generated_at);
            document.getElementById('lastUpdate').textContent = lastUpdate.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            displayStatsCards();
            displayAdvancedMetrics();
            displayWorkoutAnalysis();
            createHeartRateChart();
            createStepsChart();
            createSleepChart();
            createEnergyChart();
            createDistanceChart();
            createHRDistributionChart();
        }
        
        function displayStatsCards() {
            const stats = healthData.stats;
            const cards = [
                {
                    label: 'avg heart rate',
                    value: stats.heart_rate?.avg_30d || 0,
                    unit: 'bpm',
                    subtext: `min ${stats.heart_rate?.min || 0} / max ${stats.heart_rate?.max || 0}`,
                },
                {
                    label: 'avg daily steps',
                    value: stats.steps?.avg_30d || 0,
                    unit: '',
                    subtext: `7d avg ${stats.steps?.avg_7d || 0}`,
                },
                {
                    label: 'avg sleep',
                    value: stats.sleep?.avg_30d || 0,
                    unit: 'h',
                    subtext: `min ${stats.sleep?.min_hours || 0}h / max ${stats.sleep?.max_hours || 0}h`,
                },
                {
                    label: 'daily energy',
                    value: stats.active_energy?.avg_30d || 0,
                    unit: 'kcal',
                    subtext: 'last 30 days avg',
                },
                {
                    label: 'distance 30d',
                    value: stats.distance_walking?.total_30d || 0,
                    unit: 'km',
                    subtext: `avg ${stats.distance_walking?.avg_30d || 0} km/day`,
                },
                {
                    label: 'total records',
                    value: healthData.meta.total_records,
                    unit: '',
                    subtext: 'data points',
                },
            ];
            
            const grid = document.getElementById('statsGrid');
            grid.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="label">${card.label}</div>
                    <div class="value">${Math.round(card.value).toLocaleString()}${card.unit}</div>
                    <div class="subtext">${card.subtext}</div>
                </div>
            `).join('');
        }
        
        function displayAdvancedMetrics() {
            const stats = healthData.stats;
            const readiness = stats.readiness || {};
            const recovery = stats.recovery || {};
            const load = stats.training_load || {};
            
            const metricsHTML = `
                <div style="border: 2px solid #000; padding: 25px; background: #fafafa;">
                    <h2 style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
                        today's training insights
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="border: 1px solid #000; padding: 20px; background: white;">
                            <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 10px;">
                                readiness score
                            </div>
                            <div style="font-size: 48px; font-weight: bold; margin-bottom: 10px;">
                                ${readiness.score || 0}<span style="font-size: 20px;">/100</span>
                            </div>
                            <div style="font-size: 10px; margin-bottom: 15px; line-height: 1.6;">
                                ${readiness.recommendation || 'no data'}
                            </div>
                            ${readiness.factors ? `
                                <div style="font-size: 9px; color: #666; border-top: 1px solid #eee; padding-top: 10px;">
                                    sleep: ${readiness.factors.sleep || 0}/100<br>
                                    resting hr: ${readiness.factors.resting_hr || 0}/100<br>
                                    activity: ${readiness.factors.activity || 0}/100
                                </div>
                            ` : ''}
                        </div>
                        
                        <div style="border: 1px solid #000; padding: 20px; background: white;">
                            <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 10px;">
                                recovery status
                            </div>
                            <div style="font-size: 48px; font-weight: bold; margin-bottom: 10px;">
                                ${recovery.score || 0}<span style="font-size: 20px;">/100</span>
                            </div>
                            <div style="font-size: 10px; margin-bottom: 15px;">
                                status: <strong style="text-transform: uppercase;">${recovery.status || 'unknown'}</strong>
                            </div>
                            <div style="font-size: 9px; color: #666; border-top: 1px solid #eee; padding-top: 10px;">
                                recovery score indicates how well<br>
                                your body has recovered from<br>
                                recent training stress
                            </div>
                        </div>
                        
                        <div style="border: 1px solid #000; padding: 20px; background: white;">
                            <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 10px;">
                                training load (7d)
                            </div>
                            <div style="font-size: 48px; font-weight: bold; margin-bottom: 10px;">
                                ${load.current || 0}
                            </div>
                            <div style="font-size: 10px; margin-bottom: 15px;">
                                trend: <strong style="text-transform: uppercase;">${load.trend || 'unknown'}</strong>
                            </div>
                            <div style="font-size: 9px; color: #666; border-top: 1px solid #eee; padding-top: 10px;">
                                normalized activity load<br>
                                based on steps and movement<br>
                                over the last week
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('advancedMetrics').innerHTML = metricsHTML;
        }
        
        function displayWorkoutAnalysis() {
            const workouts = healthData.data.workouts || [];
            
            if (workouts.length === 0) {
                return;
            }
            
            // Calculate workout stats
            const totalWorkouts = workouts.length;
            const totalVolume = workouts.reduce((sum, w) => sum + w.total_volume, 0);
            const avgVolume = totalVolume / totalWorkouts;
            const totalSets = workouts.reduce((sum, w) => sum + w.total_sets, 0);
            
            // Analyze frequency
            const daysSinceOct9 = Math.ceil((new Date() - new Date('2025-10-09')) / (1000 * 60 * 60 * 24));
            const frequency = totalWorkouts / (daysSinceOct9 / 7);  // workouts per week
            
            // Get recommendation based on data
            const recommendation = getTrainingRecommendation(workouts, frequency);
            
            const workoutHTML = `
                <div style="border: 2px solid #000; padding: 25px; background: #fff;">
                    <h2 style="font-size: 12px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
                        workout analysis & recommendations
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                        <div>
                            <h3 style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;">recent workouts (since oct 9)</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 9px; color: #666; margin-bottom: 5px;">total sessions</div>
                                <div style="font-size: 24px; font-weight: bold;">${totalWorkouts}</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 9px; color: #666; margin-bottom: 5px;">weekly frequency</div>
                                <div style="font-size: 24px; font-weight: bold;">${frequency.toFixed(1)}x/week</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 9px; color: #666; margin-bottom: 5px;">avg volume</div>
                                <div style="font-size: 24px; font-weight: bold;">${Math.round(avgVolume)} kg</div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 9px; color: #666; margin-bottom: 5px;">total sets</div>
                                <div style="font-size: 24px; font-weight: bold;">${totalSets}</div>
                            </div>
                            
                            <div style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 20px;">
                                <h4 style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">sessions</h4>
                                ${workouts.map(w => `
                                    <div style="font-size: 10px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #f5f5f5;">
                                        <div style="font-weight: bold;">${new Date(w.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}</div>
                                        <div style="font-size: 9px; color: #666;">${w.name}</div>
                                        <div style="font-size: 9px; color: #999;">${w.duration} • ${w.total_sets} sets • ${Math.round(w.total_volume)} kg</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; background: #000; color: #fff; padding: 10px;">training recommendations</h3>
                            
                            ${recommendation}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('workoutAnalysis').innerHTML = workoutHTML;
        }
        
        function getTrainingRecommendation(workouts, frequency) {
            const readiness = healthData.stats.readiness?.score || 0;
            const recovery = healthData.stats.recovery?.score || 0;
            
            let rec = '<div style="font-size: 11px; line-height: 1.8;">';
            
            // Analysis
            rec += '<div style="margin-bottom: 20px; padding: 15px; border: 1px solid #000;">';
            rec += '<strong style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">current status</strong><br><br>';
            
            if (frequency < 2) {
                rec += '⚠️ <strong>low training frequency</strong> (' + frequency.toFixed(1) + 'x/week)<br>';
                rec += 'you are training less than 2x per week. this is insufficient for meaningful progress.<br>';
            } else if (frequency >= 2 && frequency < 4) {
                rec += '✓ <strong>moderate frequency</strong> (' + frequency.toFixed(1) + 'x/week)<br>';
                rec += 'decent frequency but there is room for more volume if recovery allows.<br>';
            } else {
                rec += '✓ <strong>high frequency</strong> (' + frequency.toFixed(1) + 'x/week)<br>';
                rec += 'excellent training frequency. ensure recovery is adequate.<br>';
            }
            
            rec += '<br>';
            rec += 'readiness: ' + readiness.toFixed(1) + '/100 • recovery: ' + recovery.toFixed(1) + '/100<br>';
            rec += '</div>';
            
            // Specific recommendations
            rec += '<div style="margin-bottom: 15px; padding: 15px; background: #fafafa;">';
            rec += '<strong style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">recommended plan</strong><br><br>';
            
            // Based on current workouts (Pull/Push split)
            const lastWorkouts = workouts.slice(-2);
            const hasPull = lastWorkouts.some(w => w.name.toLowerCase().includes('pull'));
            const hasPush = lastWorkouts.some(w => w.name.toLowerCase().includes('push'));
            
            rec += '<strong>next workout:</strong><br>';
            if (hasPush && !hasPull) {
                rec += '→ legs / lower body (you did push on oct 12)<br><br>';
            } else if (hasPull && !hasPush) {
                rec += '→ push day (chest, shoulders, triceps)<br><br>';
            } else {
                rec += '→ legs / lower body (complete the ppl cycle)<br><br>';
            }
            
            rec += '<strong>weekly structure:</strong><br>';
            rec += 'monday: push (chest, shoulders, triceps)<br>';
            rec += 'tuesday: cardio 30min (zone 2: ~120-135 bpm)<br>';
            rec += 'wednesday: pull (back, biceps)<br>';
            rec += 'thursday: active recovery (walk 10k steps)<br>';
            rec += 'friday: legs (quads, hams, glutes, calves)<br>';
            rec += 'weekend: cardio 45-60min OR rest<br><br>';
            
            rec += '<strong>volume targets:</strong><br>';
            rec += 'sets per muscle group per week: 12-18 sets<br>';
            rec += 'reps: 8-12 for hypertrophy, 4-6 for strength<br>';
            rec += 'rest between sets: 90-180 seconds<br><br>';
            
            rec += '<strong>progression:</strong><br>';
            rec += 'increase weight by 2.5-5kg when you hit top of rep range for all sets<br>';
            rec += 'track every workout in strong app (you are doing this ✓)<br>';
            rec += '</div>';
            
            // Weak points based on data
            rec += '<div style="padding: 15px; border: 1px solid #000;">';
            rec += '<strong style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">focus areas</strong><br><br>';
            rec += '1. <strong>increase daily steps to 10k+</strong> (current: 5.8k avg)<br>';
            rec += '2. <strong>add legs/lower body</strong> (missing from recent workouts)<br>';
            rec += '3. <strong>increase training frequency to 3-4x/week</strong><br>';
            rec += '4. <strong>maintain sleep at 7-8h</strong> (current: 6.5h estimated)<br>';
            rec += '</div>';
            
            rec += '</div>';
            
            return rec;
        }
        
        function getLast30DaysData(data, dateField = 'date') {
            const now = new Date();
            const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            return data.filter(item => new Date(item[dateField]) >= thirtyDaysAgo);
        }
        
        function aggregateByDay(data, dateField = 'date', valueField = 'value', aggregator = 'avg') {
            const dailyData = {};
            
            data.forEach(item => {
                const date = new Date(item[dateField]).toISOString().split('T')[0];
                if (!dailyData[date]) {
                    dailyData[date] = [];
                }
                dailyData[date].push(item[valueField]);
            });
            
            const result = [];
            for (const [date, values] of Object.entries(dailyData)) {
                let value;
                if (aggregator === 'avg') {
                    value = values.reduce((a, b) => a + b, 0) / values.length;
                } else if (aggregator === 'sum') {
                    value = values.reduce((a, b) => a + b, 0);
                } else if (aggregator === 'max') {
                    value = Math.max(...values);
                }
                result.push({ date, value });
            }
            
            return result.sort((a, b) => a.date.localeCompare(b.date));
        }
        
        function createHeartRateChart() {
            const last30Days = getLast30DaysData(healthData.data.heart_rate);
            const dailyAvg = aggregateByDay(last30Days, 'date', 'value', 'avg');
            
            new Chart(document.getElementById('heartRateChart'), {
                type: 'line',
                data: {
                    labels: dailyAvg.map(d => d.date),
                    datasets: [{
                        data: dailyAvg.map(d => Math.round(d.value)),
                        borderColor: '#000',
                        backgroundColor: 'rgba(0, 0, 0, 0.05)',
                        tension: 0.1,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: false,
                            title: { display: true, text: 'bpm', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            type: 'time',
                            time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        }
                    }
                }
            });
        }
        
        function createStepsChart() {
            const last30Days = getLast30DaysData(healthData.data.steps);
            const dailySum = aggregateByDay(last30Days, 'date', 'value', 'sum');
            
            new Chart(document.getElementById('stepsChart'), {
                type: 'bar',
                data: {
                    labels: dailySum.map(d => d.date),
                    datasets: [{
                        data: dailySum.map(d => Math.round(d.value)),
                        backgroundColor: '#000',
                        borderColor: '#000',
                        borderWidth: 0,
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: true,
                            title: { display: true, text: 'steps', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            type: 'time',
                            time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        }
                    }
                }
            });
        }
        
        function createSleepChart() {
            const last30Days = getLast30DaysData(healthData.data.sleep, 'start');
            const dailySum = aggregateByDay(last30Days.map(s => ({
                date: s.start,
                value: s.duration_hours
            })), 'date', 'value', 'sum');
            
            new Chart(document.getElementById('sleepChart'), {
                type: 'bar',
                data: {
                    labels: dailySum.map(d => d.date),
                    datasets: [{
                        data: dailySum.map(d => d.value.toFixed(1)),
                        backgroundColor: '#000',
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: true,
                            max: 12,
                            title: { display: true, text: 'hours', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            type: 'time',
                            time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        }
                    }
                }
            });
        }
        
        function createEnergyChart() {
            const last30Days = getLast30DaysData(healthData.data.active_energy);
            const dailySum = aggregateByDay(last30Days, 'date', 'value', 'sum');
            
            new Chart(document.getElementById('energyChart'), {
                type: 'line',
                data: {
                    labels: dailySum.map(d => d.date),
                    datasets: [{
                        data: dailySum.map(d => Math.round(d.value)),
                        borderColor: '#000',
                        backgroundColor: 'rgba(0, 0, 0, 0.05)',
                        tension: 0.1,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: true,
                            title: { display: true, text: 'kcal', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            type: 'time',
                            time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        }
                    }
                }
            });
        }
        
        function createDistanceChart() {
            const last30Days = getLast30DaysData(healthData.data.distance_walking);
            const dailySum = aggregateByDay(last30Days, 'date', 'value', 'sum');
            
            new Chart(document.getElementById('distanceChart'), {
                type: 'line',
                data: {
                    labels: dailySum.map(d => d.date),
                    datasets: [{
                        data: dailySum.map(d => d.value.toFixed(2)),
                        borderColor: '#000',
                        backgroundColor: 'rgba(0, 0, 0, 0.05)',
                        tension: 0.1,
                        fill: true,
                        borderWidth: 1,
                        pointRadius: 2,
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: true,
                            title: { display: true, text: 'km', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            type: 'time',
                            time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        }
                    }
                }
            });
        }
        
        function createHRDistributionChart() {
            const hrData = healthData.data.heart_rate.map(d => d.value);
            
            const bins = {};
            const binSize = 5;
            hrData.forEach(hr => {
                const bin = Math.floor(hr / binSize) * binSize;
                bins[bin] = (bins[bin] || 0) + 1;
            });
            
            const sortedBins = Object.keys(bins).sort((a, b) => Number(a) - Number(b));
            
            new Chart(document.getElementById('hrDistributionChart'), {
                type: 'bar',
                data: {
                    labels: sortedBins.map(b => `${b}-${Number(b) + binSize}`),
                    datasets: [{
                        data: sortedBins.map(b => bins[b]),
                        backgroundColor: '#000',
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: {
                            ...chartDefaults.scales.y,
                            beginAtZero: true,
                            title: { display: true, text: 'frequency', font: { family: "'Courier New', monospace", size: 10 } }
                        },
                        x: {
                            ...chartDefaults.scales.x,
                            title: { display: true, text: 'bpm range', font: { family: "'Courier New', monospace", size: 10 } }
                        }
                    }
                }
            });
        }
        
        loadHealthData();
    </script>
</body>
</html>
